{%extends 'layout/base.html'%}

{%block title%}Chi tiết khóa học{%endblock%}
{%block content%}

<div class="row mt-3">
    <div class="col-md-5 col-12">
        <img src="{{kh.image}}" class="img-fluid" alt="Responsive image">
    </div>
    <div class="col-md-7 col-12">
        <h3 class="text-info">{{kh.name}}</h3>
        <h4 class="text-danger">{{kh.hocPhi}}$</h4>
        <h4>{{kh.description|safe}}</h4>
    </div>
</div>

<div class="container mt-3">
    <h2>Thông tin lớp học</h2>
    <table class="table table-striped">
        <thead>
        <tr>
            <th>Tên lớp</th>
            <th>Lịch học</th>
            <th>Số HV tối đa</th>
            <th>Đã đăng ký</th>
            <th>Ngày bắt đầu</th>
            <th>Ngày kết thúc</th>
            <th></th>
        </tr>
        </thead>
        <tbody>
        {%for l in lh%}
        {% set so_hv_da_dang_ky = l.phieudangkys|selectattr('trangThai', 'in', ['Chờ xác nhận', 'Đã xác
        nhận'])|list|length %}
        <tr>
            <td>{{l.name}}</td>
            <td>{{l.lichHoc}}</td>
            <td>{{l.soHVToiDa}}</td>
            <td>
                <span class="badge {% if so_hv_da_dang_ky >= l.soHVToiDa %}bg-danger{% else %}bg-success{% endif %}">
                    {{ so_hv_da_dang_ky }}/{{ l.soHVToiDa }}
                </span>
            </td>
            <td>{{l.ngayBD}}</td>
            <td>{{l.ngayKT}}</td>
            <td>
                {% if current_user.is_authenticated %}
                    {% if so_hv_da_dang_ky < l.soHVToiDa %}
                    <a href="{{ url_for('dang_ky_khoa_hoc', lophoc_id=l.id) }}"
                       class="btn btn-danger btn-sm"
                       onclick="return confirm('Bạn có chắc muốn đăng ký lớp {{l.name}}?')">
                        <i class="fas fa-pen me-1"></i>Đăng ký
                    </a>
                    {% else %}
                    <button class="btn btn-secondary btn-sm" disabled>
                        <i class="fas fa-ban me-1"></i>Đã đầy
                    </button>
                    {% endif %}
                {% else %}
                <a href="{{ url_for('login_my_user') }}?next={{ url_for('details', id=kh.id) }}"
                   class="btn btn-warning btn-sm">
                    <i class="fas fa-sign-in-alt me-1"></i>Đăng nhập để đăng ký
                </a>
                {% endif %}
            </td>
        </tr>
        {%endfor%}
        </tbody>
    </table>
</div>

<div class="mt-3 mb-5">
    <a href="/" class="btn btn-primary">
        <i class="fas fa-home me-1"></i>Quay lại trang chủ
    </a>
    {% if current_user.is_authenticated and current_user.role.name == 'USER' %}
    <a href="{{ url_for('xem_phieu_dang_ky') }}" class="btn btn-info">
        <i class="fas fa-file-alt me-1"></i>Xem phiếu đăng ký của tôi
    </a>
    <a href="{{ url_for('hoadon_cua_toi') }}" class="btn btn-warning">
        <i class="fas fa-receipt me-1"></i>Xem hóa đơn của tôi
    </a>
    {% endif %}
</div>

{%endblock%}